<!DOCTYPE html>
<!--
Copyright (c) 2019 Holger Voormann and others.

This program and the accompanying materials are made
available under the terms of the Eclipse Public License 2.0
which is available at https://www.eclipse.org/legal/epl-2.0/

SPDX-License-Identifier: EPL-2.0
-->
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Help</title>
  <link rel="stylesheet" type="text/css" href="m.css">
  <script type="text/javascript" src="m.js"></script>
  <script type="text/javascript">
    var tocWidth = 360;
    var sliderWidth = 12;
    function h(a, c, d, e) {
        if (typeof _eh != 'undefined')
            _eh.h(a, '', true, d, c, e)
    };
    function v(a, c, d, e) {
        if (typeof _eh != 'undefined')
            _eh.h(a, 's', true, d, c, e)
    };
    function addEvent(o, type, fn){
       if (o.addEventListener) o.addEventListener(type, fn, false);
       else if (o.attachEvent) {
          o['e'+type+fn] = fn;
          o[type+fn] = function() { o['e'+type+fn](window.event); }
          o.attachEvent('on'+type, o[type+fn]);
       }
    }
    function updateContentFrameSize() {
        // see https://stackoverflow.com/a/49261999 and https://stackoverflow.com/a/819455
        var contentFrame = document.getElementById('m-content');
        var contentFrameDocument = contentFrame.contentWindow.document;
        var contentFrameDocumentElement = contentFrameDocument.documentElement || contentFrameDocument.body;
        var magic = 1;

        // start with 0x0 (otherwise issues in Chrome)
        contentFrame.width  = '0';
        contentFrame.height  = '0';

        // available/required width
        // var innerWidth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
        var clientWidth = document.documentElement.clientWidth || document.body.clientWidth;
        var widthAvailable = clientWidth - tocWidth - magic;
        var widthMinRequired = contentFrameDocumentElement.scrollWidth;
        contentFrame.width  = (widthMinRequired > widthAvailable ? widthMinRequired : widthAvailable) + 'px';
        contentFrame.height = contentFrameDocumentElement.scrollHeight + 'px';

        // with vertical scrollbar less space is available
        var newClientWidth = document.documentElement.clientWidth || document.body.clientWidth;
        if (newClientWidth < clientWidth) {
            widthAvailable = newClientWidth - tocWidth - magic;
            contentFrame.width  = (widthMinRequired > widthAvailable ? widthMinRequired : widthAvailable) + 'px';
            contentFrame.height = contentFrameDocumentElement.scrollHeight + 'px';
        }

    }
    function initContentFrame() {
        updateContentFrameSize();
        addEvent(window, 'resize', updateContentFrameSize);
    }
    function initSearchField() {
        var callbackFn = function(responseText) {
            var nodes = getNodes(parseXml(responseText));
            var firstId;
            var tocs = [];
            for (var i = 0; i < nodes.length; i++) {
                 var n = nodes[i];
                 if (n.tagName != 'node') continue;
                 var title = n.getAttribute('title');
                 var id = n.getAttribute('id');
                 var href = n.getAttribute('href');
                 if (!firstId) firstId = id;
                 tocs.push(title ? title : '');
                 tocs.push(id ? id : '');
                 tocs.push(href  ? href : '');
            }
            _eh.e(document.getElementById('f'), tocs, firstId, true, 10,
                function shortenBookName(bookName) {
                    return bookName.replace(
                            /\s+Documentation(\s+\-\s+[0-9,\-]+\s+Preview)?$/i,
                            '')
                });
        }
        var request = new XMLHttpRequest();
        request.onreadystatechange = function() {
            if (request.readyState == 4 && request.status == 200)
                callbackFn(request.responseText);
        }
        request.open('GET', '../../advanced/tocfragment');
        request.send();
    };

    function remoteRequest(url, callbackFn) {
        var request = new XMLHttpRequest();
        request.onreadystatechange = function() {
            if (request.readyState == 4 && request.status == 200)
                callbackFn(request.responseText);
        }
        request.open('GET', url);
        request.send();
        if (openRequest && openRequest.abort) openRequest.abort();
        if (!uncancelable) openRequest = request;
    }

    var parseXml;
    if (typeof window.DOMParser != "undefined") {
        parseXml = function(xmlStr) {
            return (new window.DOMParser()).parseFromString(xmlStr, "text/xml");
        };
    } else if (typeof window.ActiveXObject != "undefined" &&
           new window.ActiveXObject("Microsoft.XMLDOM")) {
        parseXml = function(xmlStr) {
            var xmlDoc = new window.ActiveXObject("Microsoft.XMLDOM");
            xmlDoc.async = "false";
            xmlDoc.loadXML(xmlStr);
            return xmlDoc;
        };
    }

    function init() {

        // load TOC
        var callbackFn = function(responseText) {
            var start = responseText.indexOf('title="Topic View" src=\'');
            if( start > 0) {
                var end = responseText.indexOf("'", start + 24);
                document.getElementById('m-content').src = '../' + responseText.substring(start + 24, end).replace(/&#47;/g, '/').replace(/&#46;/g, '.');
                loadTocChildrenInit(document.getElementById('m-toc'));
            }
        }
        var request = new XMLHttpRequest();
        request.onreadystatechange = function() {
            if (request.readyState == 4 && request.status == 200)
                callbackFn(request.responseText);
        }
        request.open('GET', '../../advanced/content.jsp');
        request.send();

        // activate slider (to resize TOC width)
        var slider = document.getElementById("m-slider");
        slider.mousemove = function (e) {
            tocWidth = e.pageX + 8;
            if (tocWidth < sliderWidth) tocWidth = sliderWidth;
            var asideStyle = document.getElementsByTagName('aside')[0].style;
            asideStyle.transition = '';
            asideStyle.width = tocWidth + 'px';
            document.getElementById("m-slider").setAttribute('class', '');
            updateContentFrameSize();
        };
        slider.onmousedown = function (e) {
            try{
                document.getElementById("m-ovrl").style.display = 'block';
                document.documentElement.addEventListener('mousemove', slider.doDrag, false);
                document.documentElement.addEventListener('mouseup', slider.stopDrag, false);
            } catch (e) {
            }
        }
        slider.doDrag = function (e) {
            if (e.which != 1){
                slider.stopDrag(e);
                return;
            }
            slider.mousemove(e);
        }
        slider.stopDrag = function (e) {
            document.getElementById("m-ovrl").style.display = 'none';
            document.documentElement.removeEventListener('mousemove', slider.doDrag, false);
            document.documentElement.removeEventListener('mouseup', slider.stopDrag, false);
        }
        var toggle_toc = function (e) {
            tocWidth = -tocWidth;
            var asideStyle = document.getElementsByTagName('aside')[0].style;
            asideStyle.transition = 'width .25s ease-in';
            asideStyle.width = (tocWidth < sliderWidth ? sliderWidth : tocWidth) + 'px';
            document.getElementById("m-slider").setAttribute('class', tocWidth < sliderWidth ? 'o' : '');
            updateContentFrameSize();
        }
        slider.ondblclick = toggle_toc;
        document.getElementById("m-slider_").onclick = toggle_toc;
    }

    // TODO remove when integrated into Eclipse
    // (the following function is only required to support older Eclipse versions having GIF instead of SVG icons)
    var iconExtension = '.svg';
    function loadTocChildrenInit(item, toc, path) {
        var callbackFn = function(responseText) {
            if(responseText.indexOf('"images/e_restore.gif"') > 0) {
                iconExtension = '.gif';
            }
            loadTocChildren(item, toc, path);
        }
        var request = new XMLHttpRequest();
        request.onreadystatechange = function() {
            if (request.readyState == 4 && request.status == 200)
                callbackFn(request.responseText);
        }
        request.open('GET', '../../advanced/contentToolbar.jsp');
        request.send();
    }

    function loadTocChildren(item, toc, path) {
        var callbackFn = function(responseText) {
            showLoadedTocChildren(item, parseXml(responseText), toc, path);
        }
        var request = new XMLHttpRequest();
        request.onreadystatechange = function() {
            if (request.readyState == 4 && request.status == 200)
                callbackFn(request.responseText);
        }
        request.open('GET', '../../advanced/tocfragment' + (toc ? '?toc=' + toc : '') + (path ? '&path=' + path : ''));
        request.send();
    }

    function createElement(parent, name, clazz, text) {
        var element = document.createElement(name);
        if (parent) {
            parent.appendChild(element);
        }
        if (clazz) {
            element.setAttribute('class', clazz);
        }
        if (text) {
            element.appendChild(document.createTextNode(text));
        }
        return element;
    }

    function getNodes(xml, toc, path) {
        var books = xml.documentElement.childNodes;
        if (!toc) return books;
        var book;
        for (var i = 0; i < books.length; i++) {
            book = books[i];
            if (book.tagName == 'node' && toc == book.getAttribute('id')) {
                if (!path) return book.childNodes;
                break;
            }
        }
        var nodes = book.childNodes;
        tocLevelLoop: while (true) {
            for (var i = 0; i < nodes.length; i++) {
                n = nodes[i];
                if (n.tagName != 'node') continue;
                var id = n.getAttribute('id');
                if (path == id) return n.childNodes;
                if (id && path.length > id.length && path.substring(0, id.length + 1) == id + '_') {
                    nodes = n.childNodes;
                    continue tocLevelLoop;
                }
            }
            break;
        }
        return [];
    }

    function showLoadedTocChildren(item, xml, toc, path) {
        var ul = createElement(item, 'ul');
        var nodes = getNodes(xml, toc, path);
        for (var i = 0; i < nodes.length; i++) {
            var n = nodes[i];
            if (n.tagName != 'node') continue;
            var li = createElement(ul, 'li', 'closed');
            if (n.getAttribute('is_leaf') != 'true') {
                var handle = createElement(li, 'span');
                handle.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" focusable="false" role="presentation">-<path d="M10.294 9.698a.988.988 0 0 1 0-1.407 1.01 1.01 0 0 1 1.419 0l2.965 2.94a1.09 1.09 0 0 1 0 1.548l-2.955 2.93a1.01 1.01 0 0 1-1.42 0 .988.988 0 0 1 0-1.407l2.318-2.297-2.327-2.307z" fill="currentColor" fill-rule="evenodd"></path></svg>';
                addEvent(handle, 'click', (function(li, toc, path) {
                    return function() { toggleTocItem(li, toc, path) };
                })(li, toc ? toc : n.getAttribute('id'), toc ? n.id : undefined));
            }
            var a = createElement(li, 'a');
            a.setAttribute('href', '../../' + n.getAttribute('href').substring(3));
            a.setAttribute('target', 'm-content');
            var icon = n.getAttribute('image');
            if (icon) {
                var iconImg = createElement(a, 'img');
                iconImg.setAttribute('src', '../../advanced/images/' + icon + iconExtension);
            }
            a.appendChild(document.createTextNode(n.getAttribute('title')));
        }
        updateContentFrameSize();
    }
    function toggleTocItem(li, toc, path) {
        var isOpen = li.getAttribute('class') == 'open' || li.getAttribute('class') == 'open loaded';
        li.setAttribute('class', isOpen ? 'closed' : 'open');
        var nodes = li.childNodes;
        for (var i = 0; i < nodes.length; i++) {
            if (nodes[i].tagName == 'UL') return;
        }
        loadTocChildren(li, toc, path);
    }
  </script>
</head>
<body onload="initSearchField();document.getElementById('focusByDefault').focus();addEvent(window, 'resize', updateContentFrameSize);init();">
  <div id="m-ovrl"></div>
  <header id="m-header">
    <form id="f" class="f" action="/help/index.jsp" target="_top" method="GET" accept-charset="utf-8">
      <input type="hidden" name="tab" value="search">
      <input id="focusByDefault" name="searchWord">
      <input class="s" type="submit" value="Search">
      <input id="b" type="hidden" name="b" value="">
    </form>
  </header>
  <main>
      <aside>
        <nav id="m-toc"></nav>
        <div id="m-slider"><div id="m-slider_"><span></span></div></div>
      </aside>
      <div class="m-content">
        <iframe id="m-content" name="m-content" onload="updateContentFrameSize()" frameborder="0" scrolling="no" allowfullscreen></iframe>
      </div>
  </main>
</body>
</html>