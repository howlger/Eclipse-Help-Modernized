<!DOCTYPE html>
<html>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Search Results</title>
  <link rel="stylesheet" type="text/css" href="m.css">
  <script type="text/javascript">

    var classPrefix = '';
    ///////////////////////////////////////////////////////////////////////////
    // copied functions from m.js
    function preventDefault(e) {
        e = e || window.event;
        e.returnValue = false; if (e.preventDefault) e.preventDefault();
    }
    function stopPropagation(e) {
        e = e || window.event;
        e.cancelBubble = true; if (e.stopPropagation) e.stopPropagation();
    }
    function createElement(parent, name, clazz, text) {
        var element = document.createElement(name);
        if (parent) {
            parent.appendChild(element);
        }
        if (clazz) {
            element.setAttribute('class', classPrefix + clazz);
        }
        if (text) {
            element.appendChild(document.createTextNode(text));
        }
        return element;
    }
    var openRequest;
    function remoteRequest(url, callbackFn, uncancelable) {
        var request = new XMLHttpRequest();
        request.onreadystatechange = function() {
            if (request.readyState == 4 && request.status == 200)
                callbackFn(request.responseText);
        }
        request.open('GET', url);
        request.send();
        if (openRequest && openRequest.abort) openRequest.abort();
        if (!uncancelable) openRequest = request;
    }
    function addHighlightedText(element, text, searchWord) {
        var searchWordLowerCase = searchWord.toLowerCase();
        var textLowerCase = text.toLowerCase();
        var hIndex = textLowerCase.indexOf(searchWordLowerCase);
        if (hIndex < 0) {
            element.appendChild(document.createTextNode(text));
            return;
        }

        var lastEnd = 0;
        while (hIndex >=0 && searchWord.length > 0) {
            element.appendChild(document.createTextNode(text.substring(lastEnd, hIndex)));
            lastEnd = hIndex + searchWord.length;
            if (   hIndex == 0
                || text.substring(hIndex - 1, hIndex).replace(/\w/, "").length != 0) {
                createElement(element, 'strong', false, text.substring(hIndex, lastEnd));
            } else {
                element.appendChild(document.createTextNode(text.substring(hIndex, lastEnd)));
            }
            hIndex = textLowerCase.indexOf(searchWordLowerCase, lastEnd);
        }
        element.appendChild(document.createTextNode(text.substring(lastEnd)));
    }
    function addEvent(o, type, fn){
        if (o.addEventListener) o.addEventListener(type, fn, false);
        else if (o.attachEvent) {
           o['e'+type+fn] = fn;
           o[type+fn] = function() { o['e'+type+fn](window.event); }
           o.attachEvent('on'+type, o[type+fn]);
        }
     }

    ///////////////////////////////////////////////////////////////////////////
    // copied functions from m_init.js
    function setCookie(cname, cvalue, exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
        var expires = "expires=" + d.toUTCString();
        document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
    }
    function getCookie(cname) {
        var name = cname + "=";
        var decodedCookie = decodeURIComponent(document.cookie);
        var ca = decodedCookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return undefined;
    }
    ///////////////////////////////////////////////////////////////////////////

    function getCookieOrDefault(cname, defaultValue) {
        var value = getCookie(cname);
        return value == undefined ? defaultValue : value;
    }
    var topCount = getCookieOrDefault("search-result-tree-top-count", 10);
    var maxPerGroup = getCookieOrDefault("search-result-tree-max-per-group", 3);
    function recalculatePageSize() {
        if (parent && parent.updateContentFrameSize) parent.updateContentFrameSize();
    }
    function asTree(results, path, depth, raw) {
        if (depth < 1) return results;
        var tree = [];
        var grouped = {};
        for (var i = 0; i < results.length; i++) {
            var r = results[i];
            r.p = i;

            // child?
            if (!r.path || r.path.length < path.length + 2) {
                tree.push(r);
                continue;
            }

            // not child -> contained in a subtree
            var key = r.path[path.length] + '\n' + r.path[path.length+1];
            if (!grouped[key]) {
                var node = { isNode: true, name: [r.path[path.length], r.path[path.length+1]], children: [r] };
                grouped[key] = node;
                tree.push(node);
            } else {
                grouped[key].children.push(r);
            }

        }

        // calculate count and set the root (if it exists)
        for (var i = 0; i < tree.length; i++) {
            var r = tree[i];
            if (r.isNode) {
                r.count = r.children.length + (r.root ? 1 : 0);
            } else if (!raw){
                var resultofStart = r.href.indexOf('?resultof=');
                var rootOfGroup = grouped['../topic' + (resultofStart < 0 ? r.href : r.href.substring(0, resultofStart))  + '\n' + r.title];
                if (rootOfGroup) {
                    rootOfGroup.root = r;
                    tree.splice(i,1);
                    i--;
                }
            }
        }

        // compact and recursion
        for (var i = 0; i < tree.length; i++) {
            var r = tree[i];
            if (!r.isNode) continue;
            compact(path, r);
            r.children = asTree(r.children, r.children[0].path.slice(0, path.length + r.name.length), depth - 1);
        }

        return tree;
    }
    function compact(path, r) {
        for (var i = path.length+2; r.children.length > 0 && !r.root; i+=2) {
            for (var j = 0; j < r.children.length; j++) {
                if (   r.children[j].path.length < i + 2
                    || r.children[j].path[i] != r.children[0].path[i]
                    || r.children[j].path[i+1] != r.children[0].path[i+1]) return;
            }
            r.name.push(r.children[0].path[i]);
            r.name.push(r.children[0].path[i+1]);
        }
    }
    var results = [];
    var searchWord = '';
    var scopeName = false;
    function init() {
        var href = window.location.href;
        if (!href || href.indexOf('/m_search.html?') < 0) return;
        function callback(data) {
            var match = new RegExp('window.location.replace[^\\?]*\\?([^"]*)').exec(data);
            if (match == null) return;

            // search word
            var element = createElement(null, 'p');
            element.innerHTML = match[1].replace(/\\u([0-9A-F]{4})/g,'&#x$1;');
            searchWord = (element.textContent ? element.textContent : element.innerText).replace(/\*(?=\&)|(^searchWord=)|(\&maxHits=.+$)/g,'');
            searchWord = searchWord.indexOf('&') < 0 ? searchWord : searchWord.substr(0, searchWord.indexOf('&'));
            searchWord = decodeURIComponent(searchWord.replace(/\+/g, '%20'));
            var isSkoped = window.location.href.indexOf('&toc=') > 0;
            scopeName = false;

            // parse HTML for results
            var withBreadcrumbs = false;
            var pattern = new RegExp('<tr[^<]*<td[^<]*<img[^<]*</td[^<]*<td[^<]*<a\\s+(?:(?:class|id|title|onmouseover|onmouseout)\\s*=\\s*(?:(?:\'[^\']*\')|(?:"[^"]*"))\\s+)*href="([^"]*)"(?:\\s+o\\w+="[^"]*")*\\s+title="([^"]*)"[^>]*>([^<]*)</a>(?:(?:(?!<[/]?tr)[\\s\\S])*</tr\\s*>\\s*<tr(?:(?!</tr)(?!class="location">)[\\s\\S])*class="location">((?:(?!</div)[\\s\\S])*))?(?:(?:(?!</tr)(?!\\sclass=["\']description["\'])[\\s\\S])*</tr){1,2}(?:(?!</tr)(?!\\sclass=["\']description["\'])[\\s\\S])*\\sclass=["\']description["\'][^>]*>([^<]*)', 'g');
            for (; (match = pattern.exec(data)) != null;) {
                var items = [];
                for (var i = 1; i < 6; i++) {
                    element.innerHTML = match[i];
                    items.push((element.textContent ? element.textContent : element.innerText).replace(/^\s+|\s+$/g,'').replace(/\s+/g,' '));
                }
                var breadcrumb = [];
                if (match[4]) {
                    var breadcrumbPattern = new RegExp('<a\\s+href="([^"]+)">([^<]+)</a>', 'g');
                    for (; (breadcrumbMatch = breadcrumbPattern.exec(match[4])) != null;) {
                        for (var i = 1; i < 3; i++) {
                            element.innerHTML = breadcrumbMatch[i];
                            breadcrumb.push((element.textContent ? element.textContent : element.innerText).replace(/^\s+|\s+$/g,'').replace(/\s+/g,' '));
                        }
                    }
                    if (isSkoped && !scopeName && breadcrumb.length > 1) scopeName = breadcrumb[1];
                    withBreadcrumbs = true;
                }
                results.push({
                    title: items[2],
                    desc: (items[4] ? items[4] : items[3]),
                    href: items[0].substring(8),
                    path: breadcrumb
, pos: (results.length+1)
                });
            }

            var mode = getCookie("search-result-mode");
            showResults(results, withBreadcrumbs, false, scopeName ? 1 : 0, mode == undefined ? 'tree' : mode);
        }
        var url = href.replace('/m_search.html?', '/../../advanced/searchView.jsp?');
        remoteRequest(url, callback);

        // for local help viewer show history buttons
        if (parent && parent.showHistoryButtons) parent.showHistoryButtons();

        if (parent && parent.scrollToTop) parent.scrollToTop();
    }

    var filters = [];
    var filterValues = [];
    var resultsToFilter = [];
    var resultsValues = [];
    function applyFilters(e) {
        var includeFilters = [];
        for (var i = 0; i < filters.length; i++) if (filters[i].checked && !filters[i].indeterminate) includeFilters.push(filterValues[i]);
        for (var i = 0; i < resultsToFilter.length; i++) {
            resultsToFilter[i].style.display =
                arrayContains(includeFilters, resultsValues[i]) ? 'block' : 'none';
        }
        stopPropagation(e);
        recalculatePageSize();
    }
    function arrayContains(array, value) {
        for (var i = 0; i < array.length; i++) {
            if (   array[i].length > 0
                && array[i].length <= value.length
                && value.substring(0, array[i].length) == array[i]) return true;
        }
        return false;
    }
    function toValue(path) {
        var result = '';
        for (var i = 0; i < path.length; i++) result += (i > 0 ? '\n' : '') + path[i];
        return result;
    }
    function showResults(resultList, withBreadcrumbs, ul, depth, mode) {

        // header
        if (!ul) {

            // remove "Searching..."
            var out = document.getElementById("results");
            while (out.firstChild) {
                out.removeChild(out.firstChild);
            }

            // show results
            if (resultList.length > 0) {
                var s = createElement(out, 'div', 'stats');
                createElement(s, 'span', 'count', resultList.length);
                s.appendChild(document.createTextNode(' results' + (scopeName ? ' in ' : '')));
                if (scopeName) {
                    createElement(s, 'span', 'scope', scopeName);
                }
                s.appendChild(document.createTextNode(':'));

                if (withBreadcrumbs && resultList.length > topCount) {
                    var treeButton = createElement(s, 'button', false, 'Tree');
                    treeButton.setAttribute('type', 'button');
                    treeButton.setAttribute('id', 'tree');
                    treeButton.onclick = function(resultList, withBreadcrumbs, depth) {
                        return function(e) {
                            showResults(resultList, withBreadcrumbs, false, depth, 'tree');
                            setCookie("search-result-mode", 'tree', 365);
                        }
                    }(resultList, withBreadcrumbs, depth);
                    if (mode == 'tree') {
                        treeButton.style.background = '#666';
                        treeButton.style.color = '#fff';
                    }
                    var filterListButton = createElement(s, 'button', false, 'List with filters');
                    filterListButton.setAttribute('type', 'button');
                    filterListButton.setAttribute('id', 'filter_list');
                    filterListButton.onclick = function(resultList, withBreadcrumbs, depth) {
                        return function(e) {
                            showResults(resultList, withBreadcrumbs, false, depth, 'filter_list');
                            setCookie("search-result-mode", 'filter_list', 365);
                        }
                    }(resultList, withBreadcrumbs, depth);

                    // filters
                    if (mode == 'filter_list') {
                        filterListButton.style.background = '#666';
                        filterListButton.style.color = '#fff';
                        filters = [];
                        filterValues = [];
                        resultsToFilter = [];
                        resultsValues = [];
                        var filterTree = asTree(resultList, resultList[0].path.slice(0, depth * 2), 9, true);
                        var filterSelect = createElement(createElement(out, 'ul', 'filter'), 'li', 'open');
                        var handle = createElement(filterSelect, 'span', 'h');
                        handle.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" focusable="false" role="presentation">-<path d="M10.294 9.698a.988.988 0 0 1 0-1.407 1.01 1.01 0 0 1 1.419 0l2.965 2.94a1.09 1.09 0 0 1 0 1.548l-2.955 2.93a1.01 1.01 0 0 1-1.42 0 .988.988 0 0 1 0-1.407l2.318-2.297-2.327-2.307z" fill="currentColor" fill-rule="evenodd"></path></svg>';
                        addEvent(handle, 'click', (function(li) {
                            return function() {
                                var isOpen = li.getAttribute('class') == 'open' || li.getAttribute('class') == 'open loaded';
                                li.setAttribute('class', isOpen ? 'closed' : 'open');
                                recalculatePageSize();
                            };
                        })(filterSelect));
                        createElement(filterSelect, 'div', 'scope', 'Filter by ' + (depth < 1 ? 'books/' : '') + 'chapters:');
                        var ft = createElement(filterSelect, 'ul');
                        function createFilterTree(root, ul, tree, path, parentCheckbox) {
                            for (var i = 0; i < tree.length; i++) {
                                var n = tree[i];
                                if (!n.isNode) continue;
                                var li = createElement(ul, 'li', 'closed');
                                var hasSubnodes = false;
                                for (var j = 0; j < n.children.length; j++) {
                                    if (n.children[j].isNode) {
                                        hasSubnodes = true;
                                        break;
                                    }
                                }
                                if (hasSubnodes) {
                                    var handle = createElement(li, 'span', 'h');
                                    handle.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" focusable="false" role="presentation">-<path d="M10.294 9.698a.988.988 0 0 1 0-1.407 1.01 1.01 0 0 1 1.419 0l2.965 2.94a1.09 1.09 0 0 1 0 1.548l-2.955 2.93a1.01 1.01 0 0 1-1.42 0 .988.988 0 0 1 0-1.407l2.318-2.297-2.327-2.307z" fill="currentColor" fill-rule="evenodd"></path></svg>';
                                    addEvent(handle, 'click', (function(li) {
                                        return function() {
                                            var isOpen = li.getAttribute('class') == 'open' || li.getAttribute('class') == 'open loaded';
                                            li.setAttribute('class', isOpen ? 'closed' : 'open');
                                            recalculatePageSize();
                                        };
                                    })(li));
                                }
                                var liInner = createElement(li, 'div', 'scope');
                                var liCheck = createElement(liInner, 'input');
                                liCheck.setAttribute('type', 'checkbox');
                                liCheck.setAttribute('checked', true);
                                liCheck.parentCheckbox = parentCheckbox;
                                filters.push(liCheck);
                                var subPath = path.slice(0, path.length).concat(n.name);
                                filterValues.push(toValue(subPath));
                                var name = '';
                                for (var j = 0; j < n.name.length; j+=2) {
                                    name += (j == 0 ? '' : ' > ') + n.name[j+1];
                                }
                                liInner.appendChild(document.createTextNode(name + ' '));
                                createElement(liInner, 'span', 'count', n.count);
                                function selectSubtree(element, checkStatus) {
                                    for (var i = 0; i < element.children.length; i++) {
                                        var n = element.children[i];
                                        if ('UL' == n.tagName || 'LI' == n.tagName || 'DIV' == n.tagName) {
                                            selectSubtree(n, checkStatus);
                                        } else if ('INPUT' == n.tagName) {
                                            n.indeterminate = false;
                                            n.checked = checkStatus;
                                        }
                                    }
                                }
                                function getChildrenChecks(checkbox) {
                                    if (!checkbox || !checkbox.parentElement || !checkbox.parentElement.parentElement || 'LI' != checkbox.parentElement.parentElement.tagName) return [];
                                    var li = checkbox.parentElement.parentElement;
                                    var children = [];
                                    for (var i = 0; i < li.children.length; i++) {
                                        var n1 = li.children[i];
                                        if ('UL' != n1.tagName) continue;
                                        for (var j = 0; j < n1.children.length; j++) {
                                            var n2 = n1.children[j];
                                            if ('LI' != n2.tagName) continue;
                                            for (var k = 0; k < n2.children.length; k++) {
                                                var n3 = n2.children[k];
                                                for (var l = 0; l < n3.children.length; l++) {
                                                    var n4 = n3.children[l];
                                                    if ('INPUT' == n4.tagName) children.push(n4);
                                                }
                                            }
                                        }
                                    }
                                    return children;
                                }
                                function updateParentsChecks(checkbox) {
                                    for (var parentCheckbox = checkbox.parentCheckbox; parentCheckbox; parentCheckbox = parentCheckbox.parentCheckbox) {
                                        var allChildrenChecked = true;
                                        var allChildrenUnchecked = true;
                                        var children = getChildrenChecks(parentCheckbox);
                                        for (var i = 0; i < children.length; i++) {
                                            var n = children[i];
                                            if (n.indeterminate) {
                                                allChildrenUnchecked = false;
                                                allChildrenChecked = false;
                                            } else if (n.checked) {
                                                allChildrenUnchecked = false;
                                            } else {
                                                allChildrenChecked = false;
                                            }
                                        }
                                        if (allChildrenChecked) {
                                            parentCheckbox.indeterminate = false;
                                            parentCheckbox.checked = true;
                                        } else if (allChildrenUnchecked) {
                                            parentCheckbox.indeterminate = false;
                                            parentCheckbox.checked = false;
                                        } else {
                                            parentCheckbox.indeterminate = true;
                                    }
                                }
                                }
                                addEvent(liInner, 'click', (function(root, liCheck, li) {
                                    return function() {
                                        selectSubtree(root, false);
                                        selectSubtree(li, true);
                                        updateParentsChecks(liCheck);
                                        applyFilters();
                                    };
                                })(root, liCheck, li));
                                if (hasSubnodes) createFilterTree(root, createElement(li, 'ul'), n.children, subPath, liCheck);
                                addEvent(liCheck, 'click', (function(liCheck, li) {
                                    return function() {
                                        selectSubtree(li, liCheck.checked);
                                        updateParentsChecks(liCheck);
                                        applyFilters();
                                    };
                                })(liCheck, li));
                            }
                        }
                        createFilterTree(ft, ft, filterTree, resultList[0].path.slice(0, depth * 2));
                    }
                }
            } else {
                var noResults = createElement(out, 'div', 'no-results', 'No topics found containing ');
                createElement(noResults, 'strong', false, searchWord);
                return;
            }

            ul = createElement(out, 'ul');
        }

        var results = !withBreadcrumbs || mode != 'tree' || resultList.length <= topCount
                      ? resultList
                      : asTree(resultList, resultList[0].path.slice(0, depth * 2), 1);
        var previousTop = false;
        for (var i = 0; i < results.length; i++) {
            var n = results[i];
            var r = createElement(ul, 'li');
            if (mode == 'filter_list' && !n.isNode) {
                resultsToFilter.push(r);
                var resultofStart = n.href.indexOf('?resultof=');
                var hrefNormed = '../topic' + (resultofStart < 0 ? n.href : n.href.substring(0, resultofStart));
                resultsValues.push(toValue(n.path.slice(0, n.path.length).concat(hrefNormed).concat(n.title)));
            }

            // subtree
            if (withBreadcrumbs && n.isNode && n.children.length > 1) {
                var name = '';
                for (var j = 0; j < n.name.length; j+=2) {
                    name += (j == 0 ? '' : ' > ') + n.name[j+1];
                }

                // expandable tree node
                var handle = createElement(r, 'span', 'h');
                handle.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" focusable="false" role="presentation">-<path d="M10.294 9.698a.988.988 0 0 1 0-1.407 1.01 1.01 0 0 1 1.419 0l2.965 2.94a1.09 1.09 0 0 1 0 1.548l-2.955 2.93a1.01 1.01 0 0 1-1.42 0 .988.988 0 0 1 0-1.407l2.318-2.297-2.327-2.307z" fill="currentColor" fill-rule="evenodd"></path></svg>';
                addEvent(handle, 'click', (function(li) {
                    return function() {
                        var isOpen = li.getAttribute('class') == 'open' || li.getAttribute('class') == 'open loaded';
                        li.setAttribute('class', isOpen ? 'closed' : 'open');
                        if (li.hasMore) li.more();
                        recalculatePageSize();
                    };
                })(r));
                r.close = (function(li) { return function() { li.setAttribute('class', 'closed'); recalculatePageSize(); }; })(r);
                r.open = (function(li) { return function() { li.setAttribute('class', 'open'); recalculatePageSize(); }; })(r);

                // node: chapter name or root topic
                if (n.root) {
                    showItem(n.root, createElement(r, 'div', 'r'), true, depth+1, n.count);
                } else {
                    var sub = createElement(r, 'div', 'scope');
                    addHighlightedText(sub, name + ' ', searchWord);
                    createElement(sub, 'span', 'count', n.count);
                }

                // subtree
                var subUl = createElement(r, 'ul');
                var j;
                for (j = 0; j < n.children.length; j++) {
                    if (   (j == maxPerGroup || n.children[j].p >= topCount)
                        && j + 1 != n.children.length) { // do not show "More..." to hide a single item
                        more = function(out, results, depth, ul, r) {
                            return function(closeSiblings) {
                                return function(e) {
                                    if (!r.hasMore) return;
                                    while (out.firstChild) {
                                        out.removeChild(out.firstChild);
                                    }
                                    showResults(results, true, out, depth, 'tree');
                                    r.hasMore = false;
                                    if (!closeSiblings) return;
                                    for (var i = 0; ul.children && i < ul.children.length; i++) {
                                        if (ul.children[i].close) ul.children[i].close();
                                    }
                                    r.open();
                                    if (parent && parent.scrollToTop) parent.scrollToTop();
                                    else if (r.scrollIntoView) r.scrollIntoView();
                                };
                            };
                        }(subUl, n.children, depth+(n.name.length/2), ul, r);
                        r.more = more(false);
                        r.hasMore = true;
                        createElement(subUl, 'li', 'more', 'More...').onclick = more(true);
                        break;
                    }
                    showItem(n.children[j], createElement(subUl, 'li'), withBreadcrumbs, depth+(n.name.length/2));
                }

                // open/close subtree
                r.setAttribute('class', j > 0 ? 'open' : 'closed');

            } else {
                showItem(n.isNode ? n.children[0] : n, r, mode == 'tree', depth);
            }
        }
        recalculatePageSize();
    }

    function showItem(node, r, showAsTree, breadcrumbFrom, count) {
        r.setAttribute('class', 'r');

        // title (linked)
        var rt = createElement(r, 'h4');
        var ra = createElement(rt, 'a');
        ra.setAttribute('href', '../../topic' + node.href);
        addHighlightedText(ra, node.title + (count ? ' ' : ''), searchWord);
        if (count) createElement(ra, 'span', 'count', count);
if (showAsTree) ra.appendChild(document.createTextNode(' [' + node.pos + ']'));

        // breadcrumb (if available)
        if (node.path.length > 0) {
            rb = createElement(r, 'div', 'location');
            var crumb = node.path.slice(breadcrumbFrom * 2);
            for (var j = 0; j < crumb.length; j+=2) {
                rbi = createElement(rb, 'span');
                addHighlightedText(rbi, crumb[j+1], searchWord);
                if (j < crumb.length-2) createElement(rbi, 'span', false, ' > ');
            }
        }

        // description
        addHighlightedText(createElement(r, 'p'), node.desc, searchWord);

    }

  </script>
</head>
<body onLoad="init()">
<div id="results"><p>Searching...</p></div>
</body>
</html>