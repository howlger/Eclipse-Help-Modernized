<!DOCTYPE html>
<html>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Search Results</title>
  <link rel="stylesheet" type="text/css" href="m.css">
  <script type="text/javascript">

    var classPrefix = '';
    ///////////////////////////////////////////////////////////////////////////
    // copied functions from m.js
    function preventDefault(e) {
        e = e || window.event;
        e.returnValue = false; if (e.preventDefault) e.preventDefault();
    }
    function stopPropagation(e) {
        e = e || window.event;
        e.cancelBubble = true; if (e.stopPropagation) e.stopPropagation();
    }
    function createElement(parent, name, clazz, text) {
        var element = document.createElement(name);
        if (parent) {
            parent.appendChild(element);
        }
        if (clazz) {
            element.setAttribute('class', classPrefix + clazz);
        }
        if (text) {
            element.appendChild(document.createTextNode(text));
        }
        return element;
    }
    var openRequest;
    function remoteRequest(url, callbackFn, uncancelable) {
        var request = new XMLHttpRequest();
        request.onreadystatechange = function() {
            if (request.readyState == 4 && request.status == 200)
                callbackFn(request.responseText);
        }
        request.open('GET', url);
        request.send();
        if (openRequest && openRequest.abort) openRequest.abort();
        if (!uncancelable) openRequest = request;
    }
    function addHighlightedText(element, text, searchWord) {
        var searchWordLowerCase = searchWord.toLowerCase();
        var textLowerCase = text.toLowerCase();
        var hIndex = textLowerCase.indexOf(searchWordLowerCase);
        if (hIndex < 0) {
            element.appendChild(document.createTextNode(text));
            return;
        }

        var lastEnd = 0;
        while (hIndex >=0 && searchWord.length > 0) {
            element.appendChild(document.createTextNode(text.substring(lastEnd, hIndex)));
            lastEnd = hIndex + searchWord.length;
            if (   hIndex == 0
                || text.substring(hIndex - 1, hIndex).replace(/\w/, "").length != 0) {
                createElement(element, 'strong', false, text.substring(hIndex, lastEnd));
            } else {
                element.appendChild(document.createTextNode(text.substring(hIndex, lastEnd)));
            }
            hIndex = textLowerCase.indexOf(searchWordLowerCase, lastEnd);
        }
        element.appendChild(document.createTextNode(text.substring(lastEnd)));
    }
    function addEvent(o, type, fn){
        if (o.addEventListener) o.addEventListener(type, fn, false);
        else if (o.attachEvent) {
           o['e'+type+fn] = fn;
           o[type+fn] = function() { o['e'+type+fn](window.event); }
           o.attachEvent('on'+type, o[type+fn]);
        }
     }
    ///////////////////////////////////////////////////////////////////////////

    var topCount = 10;
    var maxPerGroup = 3;
    function asTree(results, path, depth) {
        if (depth < 1) return results;
        var tree = [];
        var grouped = {};
        for (var i = 0; i < results.length; i++) {
            var r = results[i];
            r.p = i;

            // child?
            if (!r.path || r.path.length < path.length + 2) {
                tree.push(r);
                continue;
            }

            // not child -> contained in a subtree
            var key = r.path[path.length] + '\n' + r.path[path.length+1];
            if (!grouped[key]) {
                var node = { isNode: true, name: [r.path[path.length], r.path[path.length+1]], children: [r] };
                grouped[key] = node;
                tree.push(node);
            } else {
                grouped[key].children.push(r);
            }

        }

        // calculate count and set the root (if it exists)
        for (var i = 0; i < tree.length; i++) {
            var r = tree[i];
            if (r.isNode) {
                r.count = r.children.length + (r.root ? 1 : 0);
            } else {
                var resultofStart = r.href.indexOf('?resultof=');
                var rootOfGroup = grouped['../topic' + (resultofStart < 0 ? r.href : r.href.substring(0, resultofStart))  + '\n' + r.title];
                if (rootOfGroup) {
                    rootOfGroup.root = r;
                    tree.splice(i,1);
                    i--;
                }
            }
        }

        // compact and recursion
        for (var i = 0; i < tree.length; i++) {
            var r = tree[i];
            if (!r.isNode) continue;
            compact(path, r);
            r.children = asTree(r.children, r.children[0].path.slice(0, path.length+r.name.lenth), depth - 1);
        }

        return tree;
    }
    function compact(path, r) {
        for (var i = path.length+2; r.children.length > 0 && !r.root; i+=2) {
            for (var j = 0; j < r.children.length; j++) {
                if (   r.children[j].path.length < i + 2
                    || r.children[j].path[i] != r.children[0].path[i]
                    || r.children[j].path[i+1] != r.children[0].path[i+1]) return;
            }
            r.name.push(r.children[0].path[i]);
            r.name.push(r.children[0].path[i+1]);
        }
    }
    var results = [];
    var searchWord = '';
    var scopeName = false;
    function init() {
        var href = window.location.href;
        if (!href || href.indexOf('/m_search.html?') < 0) return;
        function callback(data) {
            var match = new RegExp('window.location.replace[^\\?]*\\?([^"]*)').exec(data);
            if (match == null) return;

            // search word
            var element = createElement(null, 'p');
            element.innerHTML = match[1].replace(/\\u([0-9A-F]{4})/g,'&#x$1;');
            searchWord = (element.textContent ? element.textContent : element.innerText).replace(/\*(?=\&)|(^searchWord=)|(\&maxHits=.+$)/g,'');
            searchWord = searchWord.indexOf('&') < 0 ? searchWord : searchWord.substr(0, searchWord.indexOf('&'));
            searchWord = decodeURIComponent(searchWord.replace(/\+/g, '%20'));
            var isSkoped = window.location.href.indexOf('&toc=') > 0;
            scopeName = false;

            // parse HTML for results
            var withBreadcrumbs = false;
            var pattern = new RegExp('<tr[^<]*<td[^<]*<img[^<]*</td[^<]*<td[^<]*<a\\s+(?:(?:class|id|title|onmouseover|onmouseout)\\s*=\\s*(?:(?:\'[^\']*\')|(?:"[^"]*"))\\s+)*href="([^"]*)"(?:\\s+o\\w+="[^"]*")*\\s+title="([^"]*)"[^>]*>([^<]*)</a>(?:(?:(?!<[/]?tr)[\\s\\S])*</tr\\s*>\\s*<tr(?:(?!</tr)(?!class="location">)[\\s\\S])*class="location">((?:(?!</div)[\\s\\S])*))?(?:(?:(?!</tr)(?!\\sclass=["\']description["\'])[\\s\\S])*</tr){1,2}(?:(?!</tr)(?!\\sclass=["\']description["\'])[\\s\\S])*\\sclass=["\']description["\'][^>]*>([^<]*)', 'g');
            for (; (match = pattern.exec(data)) != null;) {
                var items = [];
                for (var i = 1; i < 6; i++) {
                    element.innerHTML = match[i];
                    items.push((element.textContent ? element.textContent : element.innerText).replace(/^\s+|\s+$/g,'').replace(/\s+/g,' '));
                }
                var breadcrumb = [];
                if (match[4]) {
                    var breadcrumbPattern = new RegExp('<a\\s+href="([^"]+)">([^<]+)</a>', 'g');
                    for (; (breadcrumbMatch = breadcrumbPattern.exec(match[4])) != null;) {
                        for (var i = 1; i < 3; i++) {
                            element.innerHTML = breadcrumbMatch[i];
                            breadcrumb.push((element.textContent ? element.textContent : element.innerText).replace(/^\s+|\s+$/g,'').replace(/\s+/g,' '));
                        }
                    }
                    if (isSkoped && !scopeName && breadcrumb.length > 1) scopeName = breadcrumb[1];
                    withBreadcrumbs = true;
                }
                results.push({
                    title: items[2],
                    desc: (items[4] ? items[4] : items[3]),
                    href: items[0].substring(8),
                    path: breadcrumb
, pos: (results.length+1)
                });
            }

            // remove "Searching..."
            var out = document.getElementById("results");
            while (out.firstChild) {
                out.removeChild(out.firstChild);
            }

            // show results
            if (results.length > 0) {
                var s = createElement(out, 'div', 'stats');
                createElement(s, 'span', 'count', results.length);
                s.appendChild(document.createTextNode(' results' + (scopeName ? ' in ' : '')));
                if (scopeName) {
                    createElement(s, 'span', 'scope', scopeName);
                }
                s.appendChild(document.createTextNode(':'));
            } else {
                var noResults = createElement(out, 'div', 'no-results', 'No topics found containing ');
                createElement(noResults, 'strong', false, searchWord);
            }
            showResults(results, withBreadcrumbs, createElement(out, 'ul'), scopeName ? 1 : 0);
        }
        var url = href.replace('/m_search.html?', '/../../advanced/searchView.jsp?');
        remoteRequest(url, callback);

        // for local help viewer show history buttons
        if (parent && parent.showHistoryButtons) parent.showHistoryButtons();
    }

    function showResults(resultList, showAsTree, ul, depth) {

        var results = !showAsTree || resultList.length <= topCount
                      ? resultList
                      : asTree(resultList, resultList[0].path.slice(0, depth * 2), 1);

        var previousTop = false;
        for (var i = 0; i < results.length; i++) {
            var n = results[i];
            var r = createElement(ul, 'li');

            // subtree
            if (showAsTree && n.isNode && n.children.length > 1) {
                var name = '';
                for (var j = 0; j < n.name.length; j+=2) {
                    name += (j == 0 ? '' : ' > ') + n.name[j+1];
                }

                // expandable tree node
                var handle = createElement(r, 'span', 'h');
                handle.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" focusable="false" role="presentation">-<path d="M10.294 9.698a.988.988 0 0 1 0-1.407 1.01 1.01 0 0 1 1.419 0l2.965 2.94a1.09 1.09 0 0 1 0 1.548l-2.955 2.93a1.01 1.01 0 0 1-1.42 0 .988.988 0 0 1 0-1.407l2.318-2.297-2.327-2.307z" fill="currentColor" fill-rule="evenodd"></path></svg>';
                addEvent(handle, 'click', (function(li) {
                    return function() {
                        var isOpen = li.getAttribute('class') == 'open' || li.getAttribute('class') == 'open loaded';
                        li.setAttribute('class', isOpen ? 'closed' : 'open');
                        if (li.hasMore) li.more();
                    };
                })(r));
                r.close = (function(li) { return function() { li.setAttribute('class', 'closed'); }; })(r);
                r.open = (function(li) { return function() { li.setAttribute('class', 'open'); }; })(r);

                // node: chapter name or root topic
                if (n.root) {
                    showItem(n.root, createElement(r, 'div', 'r'), true, depth+1, n.count);
                } else {
                    var sub = createElement(r, 'div', 'scope');
                    addHighlightedText(sub, name + ' ', searchWord);
                    createElement(sub, 'span', 'count', n.count);
                }

                // subtree
                var subUl = createElement(r, 'ul');
                var shown = 0;
                for (var j = 0; j < n.children.length; j++) {
                    if (shown == maxPerGroup || n.children[j].p >= topCount) {
                        more = function(out, results, depth, ul, r) {
                            return function(closeSiblings) {
                                return function(e) {
                                    if (!r.hasMore) return;
                                    while (out.firstChild) {
                                        out.removeChild(out.firstChild);
                                    }
                                    showResults(results, true, out, depth);
                                    for (var i = 0; closeSiblings && ul.children && i < ul.children.length; i++) {
                                        if (ul.children[i].close) ul.children[i].close();
                                    }
                                    r.hasMore = false;
                                    r.open();
                                    if (r.scrollIntoView) r.scrollIntoView();
                                };
                            };
                        }(subUl, n.children, depth+(n.name.length/2), ul, r);
                        r.more = more(false);
                        r.hasMore = true;
                        createElement(subUl, 'li', 'more', 'More...').onclick = more(true);
                        break;
                    }
                    shown++;
                    showItem(n.children[j], createElement(subUl, 'li'), showAsTree, depth+(n.name.length/2));
                }

                // open/close subtree
                r.setAttribute('class', shown > 0 ? 'open' : 'closed');

            } else {
                showItem(n.isNode ? n.children[0] : n, r, showAsTree, depth);
            }
        }
        if (parent && parent.updateContentFrameSize) parent.updateContentFrameSize();
    }

    function showItem(node, r, showAsTree, breadcrumbFrom, count) {
        r.setAttribute('class', 'r');

        // title (linked)
        var rt = createElement(r, 'h4');
        var ra = createElement(rt, 'a');
        ra.setAttribute('href', '../../topic' + node.href);
        addHighlightedText(ra, node.title + (count ? ' ' : ''), searchWord);
        if (count) createElement(ra, 'span', 'count', count);
if (showAsTree) ra.appendChild(document.createTextNode(' [' + node.pos + ']'));

        // breadcrumb (if available)
        if (node.path.length > 0) {
            rb = createElement(r, 'div', 'location');
            var crumb = node.path.slice(breadcrumbFrom * 2);
            for (var j = 0; j < crumb.length; j+=2) {
                rbi = createElement(rb, 'span');
                addHighlightedText(rbi, crumb[j+1], searchWord);
                if (j < crumb.length-2) createElement(rbi, 'span', false, ' > ');
            }
        }

        // description
        addHighlightedText(createElement(r, 'p'), node.desc, searchWord);

    }

  </script>
</head>
<body onLoad="init()">
<div id="results"><p>Searching...</p></div>
</body>
</html>