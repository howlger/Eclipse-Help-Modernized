<!DOCTYPE html>
<html>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Search Results</title>
  <link rel="stylesheet" type="text/css" href="m.css">
  <script type="text/javascript">

    var classPrefix = '';
    ///////////////////////////////////////////////////////////////////////////
    // copied functions from m.js
    function preventDefault(e) {
        e = e || window.event;
        e.returnValue = false; if (e.preventDefault) e.preventDefault();
    }
    function stopPropagation(e) {
        e = e || window.event;
        e.cancelBubble = true; if (e.stopPropagation) e.stopPropagation();
    }
    function createElement(parent, name, clazz, text) {
        var element = document.createElement(name);
        if (parent) {
            parent.appendChild(element);
        }
        if (clazz) {
            element.setAttribute('class', classPrefix + clazz);
        }
        if (text) {
            element.appendChild(document.createTextNode(text));
        }
        return element;
    }
    var openRequest;
    function remoteRequest(url, callbackFn, uncancelable) {
        var request = new XMLHttpRequest();
        request.onreadystatechange = function() {
            if (request.readyState == 4 && request.status == 200)
                callbackFn(request.responseText);
        }
        request.open('GET', url);
        request.send();
        if (openRequest && openRequest.abort) openRequest.abort();
        if (!uncancelable) openRequest = request;
    }
    function addHighlightedText(element, text, searchWord) {
        var searchWordLowerCase = searchWord.toLowerCase();
        var textLowerCase = text.toLowerCase();
        var hIndex = textLowerCase.indexOf(searchWordLowerCase);
        if (hIndex < 0) {
            element.appendChild(document.createTextNode(text));
            return;
        }

        var lastEnd = 0;
        while (hIndex >=0) {
            element.appendChild(document.createTextNode(text.substring(lastEnd, hIndex)));
            lastEnd = hIndex + searchWord.length;
            if (   hIndex == 0
                || text.substring(hIndex - 1, hIndex).replace(/\w/, "").length != 0) {
                createElement(element, 'strong', false, text.substring(hIndex, lastEnd));
            } else {
                element.appendChild(document.createTextNode(text.substring(hIndex, lastEnd)));
            }
            hIndex = textLowerCase.indexOf(searchWordLowerCase, lastEnd);
        }
        element.appendChild(document.createTextNode(text.substring(lastEnd)));
    }
    ///////////////////////////////////////////////////////////////////////////

    function init() {
        var href = window.location.href;
        if (!href || href.indexOf('/m_search.html?') < 0) return;
        function callback(data) {
            var match = new RegExp('window.location.replace[^\\?]*\\?([^"]*)').exec(data);
            if (match == null) return;

            // search word
            var element = createElement(null, 'div');
            element.innerHTML = match[1].replace(/\\u([0-9A-F]{4})/g,'&#x$1;');
            var searchWord = (element.textContent ? element.textContent : element.innerText).replace(/\*(?=\&)|(^searchWord=)|(\&maxHits=.+$)/g,'');
            searchWord = searchWord.indexOf('&') < 0 ? searchWord : searchWord.substr(0, searchWord.indexOf('&'));
            searchWord = decodeURIComponent(searchWord.replace(/\+/g, '%20'));

            // parse HTML for results
            var pattern = new RegExp('<tr[^<]*<td[^<]*<img[^<]*</td[^<]*<td[^<]*<a\\s+(?:(?:class|id|title|onmouseover|onmouseout)\\s*=\\s*(?:(?:\'[^\']*\')|(?:"[^"]*"))\\s+)*href="([^"]*)"(?:\\s+o\\w+="[^"]*")*\\s+title="([^"]*)"[^>]*>([^<]*)</a>(?:(?:(?!<[/]?tr)[\\s\\S])*</tr\\s*>\\s*<tr(?:(?!</tr)(?!class="location">)[\\s\\S])*class="location">((?:(?!</div)[\\s\\S])*))?(?:(?:(?!</tr)(?!\\sclass=["\']description["\'])[\\s\\S])*</tr){1,2}(?:(?!</tr)(?!\\sclass=["\']description["\'])[\\s\\S])*\\sclass=["\']description["\'][^>]*>([^<]*)', 'g');
            var results = [];
            for (; (match = pattern.exec(data)) != null;) {
                var items = [];
                for (var i = 1; i < 6; i++) {
                    element.innerHTML = match[i];
                    items.push((element.textContent ? element.textContent : element.innerText).replace(/^\s+|\s+$/g,'').replace(/\s+/g,' '));
                }
                var breadcrumb = [];
                if (match[4]) {
                    var breadcrumbPattern = new RegExp('<a\\s+href="([^"]+)">([^<]+)</a>', 'g');
                    for (; (breadcrumbMatch = breadcrumbPattern.exec(match[4])) != null;) {
                        for (var i = 1; i < 3; i++) {
                            element.innerHTML = breadcrumbMatch[i];
                            breadcrumb.push((element.textContent ? element.textContent : element.innerText).replace(/^\s+|\s+$/g,'').replace(/\s+/g,' '));
                        }
                    }
                }
                results.push({
                    title: items[2],
                    desc: (items[4] ? items[4] : items[3]),
                    href: items[0].substring(8),
                    breadcrumb: breadcrumb
                });
            }

            // remove "Searching..."
            var out = document.getElementById("results");
            while (out.firstChild) {
                out.removeChild(out.firstChild);
            }

            // show results
            if (results.length > 0) {
                createElement(out, 'div', 'stats', results.length + ' results:');
            } else {
                var noResults = createElement(out, 'div', 'no-results', 'No topics found containing ');
                createElement(noResults, 'strong', false, searchWord);
            }
            var rl = createElement(out, 'ul');
            for (var i = 0; i < results.length; i++) {
                var r = createElement(rl, 'li');
                r.onmouseup = r.ontouchend = function(a, b) {return function(e) {preventDefault(e); if (!a.canceled && (e.button == undefined || e.button == 0)) {location = b}}}(r, '../../topic' + results[i].href);

                // title (linked)
                var rt = createElement(r, 'h4');
                var ra = createElement(rt, 'a', false);
                ra.setAttribute('href', '../../topic' + results[i].href);
                addHighlightedText(ra, results[i].title, searchWord);

                // breadcrumb (if available)
                if (results[i].breadcrumb.length > 0) {
                    rb = createElement(r, 'div');
                    for (var j = 0; j < results[i].breadcrumb.length-1; j+=2) {
                        rbi = createElement(rb, 'span');
                        addHighlightedText(rbi, results[i].breadcrumb[j+1], searchWord);
                        if (j < results[i].breadcrumb.length-2) createElement(rbi, 'span', false, ' > ');
                    }
                }

                // description
                addHighlightedText(createElement(r, 'p'), results[i].desc, searchWord);
            }
            if (parent && parent.updateContentFrameSize) parent.updateContentFrameSize();

        }
        var url = href.replace('/m_search.html?', '/../../advanced/searchView.jsp?');
        remoteRequest(url, callback);

        // For local help viewer show history buttons
        showHistoryButtons();
    }

    // Show browsing buutons when run locally as help viewer
    function showHistoryButtons() {
        var results = document.getElementById('results');
        if ( !!results ) {
            if (parent && parent.showHistoryButtons) parent.showHistoryButtons();
        }
    }

    // Go one page back in browser history
    // (required in standalone help viewer only)
    function goBack() {
          window.history.back();
    }

  </script>
</head>
<body onLoad="init()">
<div id="results"><p>Searching...</p></div>
</body>
</html>